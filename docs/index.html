<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentação Técnica - BID System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Highlight.js para código -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/vs2015.min.css">
    
    <!-- Custom CSS -->
    <style>
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
            overflow-y: auto;
        }
        
        .sidebar-sticky {
            position: relative;
            top: 0;
            height: calc(100vh - 48px);
            padding-top: .5rem;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        main {
            padding-top: 48px;
        }
        
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }
        
        .nav-link {
            padding: .5rem 1rem;
            color: #333;
        }
        
        .nav-link:hover {
            color: #007bff;
        }
        
        code {
            color: #e83e8c;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">BID System - Documentação Técnica</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="#visao-geral">Visão Geral</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#arquitetura">Arquitetura</a>
                            <ul class="nav flex-column ms-3">
                                <li class="nav-item">
                                    <a class="nav-link" href="#mvc-service">MVC + Service</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#estrutura-arquivos">Estrutura de Arquivos</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#autenticacao">Autenticação</a>
                            <ul class="nav flex-column ms-3">
                                <li class="nav-item">
                                    <a class="nav-link" href="#auth-module">Módulo Auth</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#token-handling">Token Handling</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#frontend">Frontend</a>
                            <ul class="nav flex-column ms-3">
                                <li class="nav-item">
                                    <a class="nav-link" href="#controllers">Controllers</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#services">Services</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#utils">Utils</a>
                                    <ul class="nav flex-column ms-3">
                                        <li class="nav-item">
                                            <a class="nav-link" href="#toast">Toast</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="#logger">Logger</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#backend">Backend</a>
                            <ul class="nav flex-column ms-3">
                                <li class="nav-item">
                                    <a class="nav-link" href="#api">API</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#database">Database</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#modulos">Módulos</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Conteúdo Principal -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Visão Geral -->
                <section id="visao-geral" class="mb-5">
                    <h1 class="border-bottom pb-2">Visão Geral</h1>
                    <p>O BID System é um sistema de gerenciamento de contratos e manutenções preventivas. Esta documentação técnica detalha a arquitetura, padrões e implementações do sistema.</p>
                </section>

                <!-- Arquitetura -->
                <section id="arquitetura" class="mb-5">
                    <h1 class="border-bottom pb-2">Arquitetura</h1>
                    
                    <div id="mvc-service">
                        <h2>Padrão MVC + Service</h2>
                        <p>O sistema utiliza uma arquitetura MVC estendida com uma camada de Service:</p>
                        <ul>
                            <li><strong>Model:</strong> Representação dos dados e regras de negócio</li>
                            <li><strong>View:</strong> Interface do usuário (HTML)</li>
                            <li><strong>Controller:</strong> Gerenciamento de eventos e UI</li>
                            <li><strong>Service:</strong> Lógica de negócios e comunicação com API</li>
                        </ul>
                    </div>

                    <div id="estrutura-arquivos" class="mt-4">
                        <h2>Estrutura de Arquivos</h2>
                        <pre><code>
/bid
├── /api
│   ├── /v1
│   │   ├── /auth
│   │   ├── /clientes
│   │   └── /contratos
│   ├── /config
│   └── /utils
├── /assets
│   ├── /css
│   ├── /js
│   │   ├── /controllers
│   │   ├── /services
│   │   └── /utils
│   └── /vendor
├── /docs
└── /pages</code></pre>
                    </div>
                </section>

                <!-- Autenticação -->
                <section id="autenticacao" class="mb-5">
                    <h1 class="border-bottom pb-2">Autenticação</h1>
                    
                    <div id="auth-module">
                        <h2>Módulo Auth</h2>
                        <p>O módulo de autenticação é implementado como um ES6 module:</p>
                        <pre><code class="javascript">
// auth.js
const Auth = {
    async verificarAuth() {
        // Verifica token e redireciona se necessário
    },
    
    get token() {
        return localStorage.getItem('token');
    },
    
    get usuario() {
        return JSON.parse(localStorage.getItem('usuario'));
    }
};

export default Auth;</code></pre>
                    </div>

                    <div id="token-handling" class="mt-4">
                        <h2>Token Handling</h2>
                        <p>Implementação do interceptor Axios para tokens:</p>
                        <pre><code class="javascript">
axios.interceptors.request.use(config => {
    const token = Auth.token;
    if (token) {
        config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
});</code></pre>
                    </div>
                </section>

                <!-- Frontend -->
                <section id="frontend" class="mb-5">
                    <h1 class="border-bottom pb-2">Frontend</h1>
                    
                    <div id="controllers">
                        <h2>Controllers</h2>
                        <p>Padrão para implementação de controllers:</p>
                        <pre><code class="javascript">
class ModuloController {
    constructor() {
        this.service = new ModuloService();
        this.initEventListeners();
        this.initDataTable();
    }

    async listar() {
        try {
            const data = await this.service.listar();
            this.dataTable.clear().rows.add(data).draw();
        } catch (error) {
            Logger.error('Erro ao listar', error);
        }
    }
}</code></pre>
                    </div>

                    <div id="services" class="mt-4">
                        <h2>Services</h2>
                        <p>Padrão para implementação de services:</p>
                        <pre><code class="javascript">
class ModuloService {
    constructor() {
        this.baseUrl = '../api/v1/modulo';
    }

    async listar() {
        await Auth.verificarAuth();
        const response = await axios.get(this.baseUrl);
        return response.data;
    }
}</code></pre>
                    </div>

                    <div id="utils" class="mt-4">
                        <h2>Utils</h2>
                        <p>Utilitários padrão do sistema:</p>
                        <div id="toast">
                            <h3>Toast</h3>
                            <p>O sistema utiliza um wrapper personalizado para o Toastr, localizado em <code>/assets/js/toast.js</code>, que fornece uma interface consistente para notificações visuais.</p>
                            
                            <h4>Configuração Global</h4>
                            <pre><code class="javascript">
// Configuração do Toastr
toastr.options = {
    closeButton: true,      // Botão para fechar notificação
    debug: false,           // Modo debug desativado
    newestOnTop: true,      // Novas notificações aparecem no topo
    progressBar: true,      // Barra de progresso
    positionClass: "toast-top-right",  // Posição no canto superior direito
    preventDuplicates: false,  // Permite duplicatas
    showDuration: "300",    // Duração da animação de entrada
    hideDuration: "1000",   // Duração da animação de saída
    timeOut: "5000",        // Tempo que a notificação fica visível
    extendedTimeOut: "1000" // Tempo extra ao passar o mouse
};</code></pre>

                            <h4>Interface do Toast</h4>
                            <p>O objeto Toast expõe quatro métodos principais para diferentes tipos de notificações:</p>
                            <pre><code class="javascript">
const Toast = {
    // Mensagem de sucesso (verde)
    success(message) {
        toastr.success(message);
        Logger.info(`Toast Success: ${message}`);
    },

    // Mensagem de erro (vermelho)
    error(message) {
        toastr.error(message);
        Logger.error(`Toast Error: ${message}`);
    },

    // Mensagem de alerta (amarelo)
    warning(message) {
        toastr.warning(message);
        Logger.warn(`Toast Warning: ${message}`);
    },

    // Mensagem informativa (azul)
    info(message) {
        toastr.info(message);
        Logger.info(`Toast Info: ${message}`);
    }
};</code></pre>

                            <h4>Uso</h4>
                            <p>Para usar o Toast em qualquer módulo do sistema:</p>
                            <pre><code class="javascript">
// Sucesso
Toast.success('Operação realizada com sucesso!');

// Erro
Toast.error('Erro ao processar requisição');

// Alerta
Toast.warning('Atenção: dados incompletos');

// Informação
Toast.info('Carregando dados...');</code></pre>

                            <h4>Integração com Logger</h4>
                            <p>Cada chamada ao Toast também registra a mensagem no Logger do sistema, facilitando o debug e monitoramento:</p>
                            <ul>
                                <li>success → Logger.info</li>
                                <li>error → Logger.error</li>
                                <li>warning → Logger.warn</li>
                                <li>info → Logger.info</li>
                            </ul>

                            <h4>Dependências</h4>
                            <p>O Toast depende dos seguintes arquivos:</p>
                            <pre><code class="plaintext">
/assets
  /js
    /utils
      /Logger.js    - Para logging
    /toast.js      - Implementação principal
/plugins
  /toastr         - Biblioteca Toastr</code></pre>
                        </div>
                        <div id="logger" class="mt-4">
                            <h3>Logger</h3>
                            <p>Sistema de logging padrão do sistema:</p>
                            <ul>
                                <li><strong>Logger:</strong> Sistema de logging</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Backend -->
                <section id="backend" class="mb-5">
                    <h1 class="border-bottom pb-2">Backend</h1>
                    
                    <div id="api">
                        <h2>API</h2>
                        <p>Estrutura padrão dos endpoints:</p>
                        <pre><code class="php">
<?php
require_once '../../config/database.php';
require_once '../../utils/Logger.php';
require_once '../../auth/auth.php';

header('Content-Type: application/json');
header('Access-Control-Allow-Origin: *');

// Verifica autenticação
Auth::verificarAuth();

try {
    $db = Database::getInstance();
    $conn = $db->connect();
    
    // Lógica do endpoint
    
    echo json_encode([
        'success' => true,
        'data' => $result
    ]);
} catch (Exception $e) {
    http_response_code(500);
    echo json_encode([
        'success' => false,
        'message' => $e->getMessage()
    ]);
}</code></pre>
                    </div>

                    <div id="database" class="mt-4">
                        <h2>Database</h2>
                        <p>Padrão Singleton para conexão com banco de dados:</p>
                        <pre><code class="php">
class Database {
    private static $instance = null;
    private $conn = null;
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    public function connect() {
        if ($this->conn === null) {
            $this->conn = new PDO(/* config */);
        }
        return $this->conn;
    }
}</code></pre>
                    </div>
                </section>

                <!-- Módulos -->
                <section id="modulos" class="mb-5">
                    <h2 class="border-bottom pb-2">Módulos do Sistema</h2>
                    
                    <!-- Módulo de Clientes -->
                    <article id="modulo-clientes" class="mb-4">
                        <h3>Módulo de Clientes</h3>
                        <p>Gerenciamento completo de clientes do sistema, incluindo cadastro, edição, listagem e exclusão.</p>

                        <h4>Atualizações e Melhorias (29/11/2024)</h4>
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5>1. Correções de Interface</h5>
                                <ul>
                                    <li>Implementado ID único para o botão "Novo Cliente" (<code>btnNovoCliente</code>)</li>
                                    <li>Melhorado layout usando grid system do Bootstrap</li>
                                    <li>Corrigido seletor JavaScript para manipulação do botão</li>
                                </ul>

                                <h5>2. Otimização do Formulário</h5>
                                <ul>
                                    <li>Refatorado método <code>salvar()</code> para usar IDs específicos dos campos</li>
                                    <li>Implementado mapeamento correto entre frontend (camelCase) e backend (snake_case)</li>
                                    <li>Adicionado tratamento de máscaras para campos formatados:
                                        <ul>
                                            <li>CNPJ</li>
                                            <li>CEP</li>
                                            <li>Telefone</li>
                                            <li>Celular</li>
                                        </ul>
                                    </li>
                                </ul>

                                <h5>3. Melhorias na Manipulação de Eventos</h5>
                                <ul>
                                    <li>Migrado listener do formulário para botão salvar específico</li>
                                    <li>Implementado logging detalhado para debug</li>
                                    <li>Adicionado tratamento robusto de erros</li>
                                    <li>Incluído verificação de null/undefined com operador opcional (<code>?.</code>)</li>
                                </ul>

                                <h5>4. Segurança e Validação</h5>
                                <ul>
                                    <li>Implementado valores default para prevenir dados undefined</li>
                                    <li>Adicionado sanitização de dados antes do envio ao servidor</li>
                                    <li>Melhorado feedback de erros para o usuário</li>
                                </ul>

                                <h5>5. Próximas Melhorias Planejadas</h5>
                                <ul>
                                    <li>Validação de campos obrigatórios no frontend</li>
                                    <li>Feedback visual durante operações de salvamento</li>
                                    <li>Confirmação antes de fechar modal com dados não salvos</li>
                                    <li>Cache local para otimização de performance</li>
                                </ul>
                            </div>
                        </div>

                        <h4>Estrutura do Módulo</h4>
                        <div class="card mb-4">
                            <div class="card-body">
                                <pre><code class="language-plaintext">
/clientes
├── ClienteController.js    # Controlador principal
├── clientes.html          # Interface do usuário
└── /api
    ├── ClienteModel.php   # Modelo de dados
    ├── buscar.php         # Endpoint de busca
    ├── listar.php         # Endpoint de listagem
    ├── salvar.php         # Endpoint de salvamento
    └── excluir.php        # Endpoint de exclusão</code></pre>
                            </div>
                        </div>

                        <h4>Exemplo de Uso do Controller</h4>
                        <div class="card">
                            <div class="card-body">
                                <pre><code class="language-javascript">
// Inicialização do controller
const clienteController = new ClienteController();

// Exemplo de salvamento
async function salvarCliente() {
    try {
        await clienteController.salvar(event);
        Toast.success('Cliente salvo com sucesso');
    } catch (error) {
        Toast.error('Erro ao salvar cliente');
        Logger.error('Erro no salvamento', error);
    }
}</code></pre>
                            </div>
                        </div>
                    </article>

                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Módulo</th>
                                    <th>Status</th>
                                    <th>Descrição</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Autenticação</td>
                                    <td><span class="badge bg-success">Completo</span></td>
                                    <td>Sistema de login e controle de acesso</td>
                                </tr>
                                <tr>
                                    <td>Clientes</td>
                                    <td><span class="badge bg-success">Completo</span></td>
                                    <td>Gestão de clientes e contratos</td>
                                </tr>
                                <tr>
                                    <td>Contratos</td>
                                    <td><span class="badge bg-warning">Em Desenvolvimento</span></td>
                                    <td>Gestão de contratos de manutenção</td>
                                </tr>
                                <tr>
                                    <td>Manutenções</td>
                                    <td><span class="badge bg-secondary">Planejado</span></td>
                                    <td>Controle de manutenções preventivas</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
    </script>
</body>
</html>